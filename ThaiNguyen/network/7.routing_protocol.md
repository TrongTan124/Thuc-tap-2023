## Cơ chế định tuyến
- cơ chế định tuyến là cơ chế được sử dụng trong định tuyến động để cho phép các bộ định tuyến trao đổi thông tin định tuyến với nhau. Điều này cho phép các bộ định tuyến cập nhật bảng định tuyến của chúng theo những thay đổi xảy ra trong mạng và chọn tuyến đường tốt nhất để chuyển tiếp lưu lượng mạng.

### Administrative distance
 - là một tính năng được router dùng để chọn route tốt nhất cho việc truyền các gói tin khi có 2 hoặc hơn route đến cùng một điểm đích nhưng sử dụng các cơ chế định tuyến khác nhau. Administrative distance giúp xác định độ đáng tin cậy của các cơ chế định tuyến. Giá trị này càng nhỏ thì có độ đáng tin cậy càng lớn. Với 2 hoặc hơn route với các cơ chế định tuyến khác nhau,router sẽ chọn route có AD value thấp nhất và truyền gói tin bằng cơ chế định tuyến tương ứng với AD value đó.  Giá trị được gán cho từng loại cơ chế định tuyến sẽ khác nhau tùy vào vendor.
 Ví dụ bảng AD value của Cisco sẽ như sau :
 
 ![pic](images/cisco.png)
 
Ba cơ chế định tuyến động phổ biến sẽ được thảo luận dưới đây:

## Routing Information Protocol (RIP)
### Sơ lược 
RIP là một giao thức định tuyến động sử dụng số hop làm chỉ số định tuyến để tìm tuyến đường tốt nhất từ nguồn đến đích. Nó được phân loại là một giao thức định tuyến theo vectơ khoảng cách(distance vector).

Số hop được xác định là số lượng bộ định tuyến giữa nguồn và đích. Route có số hop thấp nhất được coi là route tốt nhất và được đưa vào bảng định tuyến(routing table). Router sẽ chọn quãng đường có số hop thấp nhất trong routing table để truyền các gói tin đi. Số hop tối đa cho cơ chế RIP là 15, nếu một địa chỉ có số hop 16 hoặc lớn hơn thì được coi là không thể truy cập.
 RIP trao đổi các bản cập nhật của mạng theo định kỳ giữa các router và các bản cập nhật luôn được phát trong mạng. Router đầy đủ được gửi trong bản cập nhật. Các router luôn tin tưởng thông tin định tuyến nhận được từ các bộ định tuyến lân cận.
### Các loại
1. RIPv1:
+ classful routing protocol: các thông tin được gửi không bao gồm subnet mask
+ không có tính năng xác thực thông tin nhận được
2. RIPv2:
+ classless routing protocol: các thông tin được gửi bao gồm subnet mask
+ có tính năng xác thực thông tin nhận được

### Cách hoạt động
- Các bộ định tuyến khám phá các bộ định tuyến lân cận của chúng và chỉ trao đổi thông tin với các router lân cận được kết nối trực tiếp
- Mỗi bộ định tuyến định kỳ phát thông tin định tuyến của nó tới các bộ định tuyến lân cận khác, bao gồm các bảng định tuyến có địa chỉ IP và số bước nhảy cần thiết để đến các địa chỉ này
- Khi một bộ định tuyến nhận được cập nhật định tuyến từ các láng giềng của nó, nó sẽ so sánh bảng định tuyến trong bản cập nhật với bảng định tuyến của chính nó. Bất kỳ tuyến đường nào có số bước nhảy nhỏ hơn tuyến đường hiện có trong bảng định tuyến của nó đều được cập nhật tương ứng và bất kỳ tuyến đường nào chưa có trong bảng định tuyến đều được thêm vào. Bộ định tuyến chọn tuyến đường tốt nhất dựa trên tuyến đường có số bước nhảy ngắn nhất.
- RIP sử dụng một cơ chế gọi là split horizon để ngăn chặn các routing loop. Sử dụng cơ chế này, một bộ định tuyến không quảng cáo các tuyến trở lại cùng một giao diện mà nó nhận được. RIP cũng sử dụng poison reverse để thông báo cho các bộ định tuyến về các mạng không thể truy cập được. Những cơ chế này sẽ được thảo luận nhiều hơn dưới đây.
- RIP sử dụng timer để quản lý việc quảng bá thông tin định tuyến. Các bản cập nhật được gửi định kỳ đến các bộ định tuyến khác và nếu một route không được cập nhật trong một thời gian nhất định, nó được coi là không hợp lệ và sẽ bị xóa khỏi bảng định tuyến trong mỗi bộ định tuyến.
- Hội tụ(convergence): khi bộ định tuyến trao đổi thông tin với các bộ định tuyến khác và cập nhật bảng định tuyến của nó, mạng sẽ hội tụ ở trạng thái mà tất cả các bộ định tuyến đều có thông tin định tuyến nhất quán.

### Routing loop
Routing loop xảy ra khi dữ liệu được định tuyến trong một vòng lặp giữa hai bộ định tuyến mà không bao giờ đến đích do lỗi mạng. RIP sử dụng cơ chế chia chân trời để ngăn điều này xảy ra.

Split horizon áp dụng quy tắc để router không được quảng bá các route đến cùng interface vừa gửi những thông tin về route đó. Điều này giúp ngăn chặn trường hợp các bộ định tuyến nhận được thông tin quảng bá của chính chúng trong một vòng lặp.


## Poison reverse
Cơ chế poison reverse thường được sử dụng với split horizon để giảm hơn nữa khả năng xảy ra các vòng lặp định tuyến.

Khi một bộ định tuyến phát hiện một route không thể truy cập, nó sẽ xác định route đó trong bảng định tuyến của nó và đặt số hop của tuyến đường đó thành 16. Sau đó, route không thể truy cập được sẽ được quảng bá tới các bộ định tuyến lân cận. Các bộ định tuyến lân cận cập nhật bảng định tuyến của chúng cho phù hợp và sau đó gửi các bản cập nhật cho các bộ định tuyến lân cận của nó. Điều này cho phép thông tin về route không thể truy cập lan truyền trên một network.

### Timer
RIP sử dụng timer để quản lý việc trao đổi thông tin giữa các bộ định tuyến.
- Update timer: thời gian mặc định để trao đổi thông tin định tuyến là 30 giây. Bộ đếm thời gian này được sử dụng để cho phép trao đổi định kỳ các bảng định tuyến giữa các bộ định tuyến.
- Invalid timer: nếu không có bản cập nhật nào sau 180 giây, thì route được coi là không hợp lệ.
- Hold down timer: thời gian router đợi 1 router lân cận phản hồi. Đó là 180 giây theo mặc định.
- Flush time: thời gian mà mục nhập của route sẽ bị xóa nếu nó không phản hồi trong thời gian tuôn ra. Đó là 60 giây theo mặc định.

### Nguồn tham khảo
1. [Nguồn 1](https://www.geeksforgeeks.org/routing-information-protocol-rip/)
2. [Nguồn 2](https://en.wikipedia.org/wiki/Routing_Information_Protocol)


## OSPF( Open Shortest Path First) protocol

OSPF is a link-state routing protocol often used in large-scale enterprise networks. OSPF operates by exchanging information between routers to build and maintain a topological map of the network.  









